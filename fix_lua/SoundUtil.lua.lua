SOUND_EVENT_ENUM = {
  COMMON_CLICK = "event:/sfx/sfx_ui/ui_sys/ui_click_gen",
  COMMON_BACK = "event:/sfx/sfx_ui/ui_sys/ui_click_back",
  COMMON_NOTICE = "event:/sfx/sfx_ui/ui_sys/ui_notif_illegal",
  COMMON_TAG_ON_CLICK = "event:/sfx/sfx_ui/ui_sys/ui_tag_1_chld",
  LV_UP_SUCCEED = "event:/sfx/sfx_ui/ui_sys/ui_role_lvup",
  TAB_TAG1 = "event:/sfx/sfx_ui/ui_sys/ui_tag_1",
  TAB_TAG2 = "event:/sfx/sfx_ui/ui_sys/ui_tag_2",
  TAB_TAG_BOTTOM = "event:/sfx/sfx_ui/ui_sys/ui_tag_bottom",
  SLIDE_EFFECT = "event:/sfx/sfx_ui/ui_sys/ui_slide_sidein",
  GET_ITEM = "event:/sfx/sfx_ui/ui_sys/ui_slide_reward",
  POPUP_WINDOW_SHOW = "event:/sfx/sfx_ui/ui_sys/ui_slide_banner_show",
  POPUP_WINDOW_CLOSE = "event:/sfx/sfx_ui/ui_sys/ui_slide_banner_off",
  SETTING_CHANGE = "event:/sfx/sfx_ui/ui_sys/ui_setup_switch",
  CARD_LIST_MOVE = "event:/sfx/sfx_ui/ui_sys/ui_role_card_move",
  CARD_LIST_MOVE_TWO = "event:/sfx/sfx_ui/ui_sys/ui_role_card_move_dual",
  CARD_SELECT = "event:/sfx/sfx_ui/ui_sys/ui_role_card_click",
  CARD_SKILL_LV_UP = "event:/sfx/sfx_ui/ui_sys/ui_lvup_skill",
  CARD_SKILL_IN = "event:/sfx/sfx_ui/ui_sys/ui_slide_single_show",
  CARD_SKILL_OUT = "event:/sfx/sfx_ui/ui_sys/ui_slide_single_off",
  CARD_LV_UP_LONG_ADD = "event:/sfx/sfx_ui/ui_sys/ui_click_lvup_item",
  CARD_LV_UP_LONG_REDUCE = "event:/sfx/sfx_ui/ui_sys/ui_click_lvup_item_reduce",
  CARD_LV_UP_SUCCEED = "event:/sfx/sfx_ui/ui_sys/ui_slide_lvup",
  CARD_BREACH_UP = "event:/sfx/sfx_ui/ui_sys/ui_role_lv_tupo",
  CARD_STAR_UP = "event:/sfx/sfx_ui/ui_sys/ui_role_juexing",
  CARD_STAR_IN = "event:/sfx/sfx_ui/ui_sys/ui_juexing_slide",
  CARD_BREACH_ON_CLICK = "event:/sfx/sfx_ui/ui_sys/ui_role_lv_tupo_click",
  CARD_ROLE_SLIDE = "event:/sfx/sfx_ui/ui_sys/ui_role_slide",
  FORMATION_SET_OK = "event:/sfx/sfx_ui/ui_sys/ui_role_set",
  SLIDE_NUMBER_CHANGE = "event:/sfx/sfx_ui/ui_sys/ui_story_chapter_slide",
  TRIAL_TYPE_SELECT = "event:/sfx/sfx_ui/ui_sys/ui_shilian_select",
  TRIAL_ENTER = "event:/sfx/sfx_ui/ui_sys/ui_shilian_enter",
  FLOAT_TIPS_GET_REWARD = "event:/sfx/sfx_ui/ui_sys/ui_notif_reward",
  BAG_BUTTON_ADD = "event:/sfx/sfx_ui/ui_sys/ui_click_item_add",
  BAG_BUTTON_REDUCE = "event:/sfx/sfx_ui/ui_sys/ui_click_item_sub",
  PLOT_CHAPTER_ON = "event:/sfx/sfx_ui/ui_sys/ui_chapter_start",
  PLOT_CHAPTER_OFF = "event:/sfx/sfx_ui/ui_sys/ui_chapter_end",
  PLOT_CHAPTER_NEXT1 = "event:/sfx/sfx_ui/ui_sys/ui_chapter_next_1",
  PLOT_CHAPTER_NEXT2 = "event:/sfx/sfx_ui/ui_sys/ui_chapter_next_2",
  PLOT_CHAPTER_NEXT3 = "event:/sfx/sfx_ui/ui_sys/ui_chapter_next_3",
  PLOT_CHAPTER_IN = "event:/sfx/sfx_ui/ui_sys/ui_chapter_slide_plant",
  PLOT_CHAPTER_STOP = "event:/sfx/sfx_ui/ui_sys/ui_chapter_slide_stop",
  PLOT_MAIN_IN = "event:/sfx/sfx_ui/ui_sys/ui_chapter_show",
  PLOT_STAGE_IN = "event:/sfx/sfx_ui/ui_sys/ui_chapter_new_plant",
  GUIDE_BADGE_IN = "event:/sfx/sfx_ui/ui_sys/ui_guid_slide_star",
  BADGE_LV_UP = "event:/sfx/sfx_ui/ui_sys/ui_badge_lvup",
  GET_ITEM_SHOW = "event:/sfx/sfx_ui/ui_sys/ui_item_show",
  FLOWER_ON_CLICK = "event:/sfx/sfx_ui/ui_sys/ui_plant_flower_click",
  FLOWER_ENTER = "event:/sfx/sfx_ui/ui_sys/ui_plant_show",
  SIGN_ENTER = "event:/sfx/sfx_ui/ui_sys/ui_sign_show",
  CARNIVA_ROTATE = "event:/sfx/sfx_ui/ui_sys/ui_jianianhua_slide",
  TASK_LIST_IN = "event:/sfx/sfx_ui/ui_sys/ui_slide_mulit",
  TASK_REFRESH = "event:/sfx/sfx_ui/ui_sys/ui_mission_refresh",
  ENERGY_ADD = "event:/sfx/sfx_ui/ui_sys/ui_tili_buy_click",
  ENERGY_CANCEL = "event:/sfx/sfx_ui/ui_sys/ui_tili_buy_cancel",
  ENERGY_BUY_USE = "event:/sfx/sfx_ui/ui_sys/ui_tili_buy_use",
  GET_ITEM_IN = "event:/sfx/sfx_ui/ui_sys/ui_win_show_gen",
  TOWER_REEL = "event:/sfx/sfx_ui/ui_sys/ui_reel_1",
  TOWER_REEL_SET = "event:/sfx/sfx_ui/ui_sys/ui_reel_set",
  SIGN_56_ON = "event:/sfx/sfx_ui/ui_sys/ui_sign_56_click_on",
  SIGN_56_OFF = "event:/sfx/sfx_ui/ui_sys/ui_sign_56_click_off",
  SIGN_56_EXPLORE = "event:/sfx/sfx_ui/ui_sys/ui_sign_56_explore",
  PLOT_PLAY_CLICK = "event:/sfx/sfx_ui/ui_sys/ui_story_click",
  STORY_PLOT_ON = "event:/sfx/sfx_ui/ui_sys/ui_slide_shiji_zhuxian_on",
  STORY_PLOT_OFF = "event:/sfx/sfx_ui/ui_sys/ui_slide_shiji_zhuxian_off",
  MAIN_CHAPTER_END = "event:/sfx/sfx_ui/ui_sys/ui_chapter_next_1_end",
  TASK_LV_REWARD_IN = "event:/sfx/sfx_ui/ui_sys/ui_jinji_in",
  TASK_LV_REWARD_OUT = "event:/sfx/sfx_ui/ui_sys/ui_jinji_out",
  STORY_MUSIC_ON = "event:/sfx/sfx_ui/ui_sys/ui_slide_shiji_yinyue_on",
  STORY_MUSIC_OFF = "event:/sfx/sfx_ui/ui_sys/ui_slide_shiji_yinyue_off",
  BURST_BATTLE = "event:/sfx/sfx_ui/ui_sys/ui_btl_ultra",
  BURST_BATTLE_HINT = "event:/sfx/sfx_ui/ui_sys/ui_ultra_notif",
  BURST_CARD = "event:/sfx/sfx_ui/ui_sys/ui_ultra_show",
  BURST_CARD_CHOOSE = "event:/sfx/sfx_ui/ui_sys/sfx_ui_baolie_choose",
  BURST_CARD_ANIM_IN = "event:/sfx/sfx_ui/ui_sys/sfx_ui_baolie_choose_winon",
  GET_ITEM_REWARD = "event:/sfx/sfx_ui/ui_sys/ui_reward_top",
  PLOT_ITEM_GET = "event:/sfx/sfx_ui/ui_sys/ui_story_item",
  FUNCTION_OPEN = "event:/sfx/sfx_ui/ui_sys/ui_unlock",
  DISPATCH_GET_ITEM = "event:/sfx/sfx_ui/ui_sys/ui_slide_dispatch",
  LV_UP_NUMBER = "event:/sfx/sfx_ui/ui_sys/ui_notif_number_lvup",
  ARENA_REFRESH = "event:/sfx/sfx_ui/ui_sys/ui_rongyao_refresh",
  ABYSS_FUNCTION_OPEN = "event:/sfx/sfx_ui/ui_sys/ui_unlock_tiny",
  SHOP_BANNER_OPEN = "event:/sfx/sfx_ui/ui_sys/ui_slide_banner_show",
  REWARD_TIPS_ON = "event:/sfx/sfx_ui/ui_sys/ui_slide_shiji_zhuxian_on",
  REWARD_TIPS_OFF = "event:/sfx/sfx_ui/ui_sys/ui_slide_shiji_zhuxian_off",
  BADGE_LV = "event:/sfx/sfx_ui/ui_sys/ui_badge_lv_fx",
  BADGE_LV_ITEM = "event:/sfx/sfx_ui/ui_sys/ui_badge_lv_item",
  BADGE_LV_TIPS = "event:/sfx/sfx_ui/ui_sys/ui_lvup_notif",
  BADGE_AUTO_WEAR = "event:/sfx/sfx_ui/ui_sys/ui_badge_on",
  BADGE_CARD_HEAD = "event:/sfx/sfx_ui/ui_sys/ui_badge_wear",
  BADGE_MIDDLE_ON = "event:/sfx/sfx_ui/ui_sys/ui_badge_showon_m",
  BADGE_RIGHT_LEFT_ON = "event:/sfx/sfx_ui/ui_sys/ui_badge_showon_rl",
  BADGE_LEFT_RIGHT_ON = "event:/sfx/sfx_ui/ui_sys/ui_badge_showon_lr",
  BADGE_MIDDLE_OFF = "event:/sfx/sfx_ui/ui_sys/ui_badge_showoff_m",
  BADGE_RIGHT_LEFT_OFF = "event:/sfx/sfx_ui/ui_sys/ui_badge_showoff_rl",
  BADGE_LEFT_RIGHT_OFF = "event:/sfx/sfx_ui/ui_sys/ui_badge_showoff_lr",
  FASHION_BUY = "event:/sfx/sfx_ui/ui_sys/ui_pingzheng_buy",
  FORMATION_ALL_UP = "event:/sfx/sfx_ui/ui_sys/ui_buzhen_all",
  BOSS_BATTLE_IN = "event:/sfx/sfx_ui/ui_sys/ui_anying_wh",
  BOSS_OPEN_TIPS = "event:/sfx/sfx_ui/ui_sys/ui_anying_new_wh",
  ROGUE_MAIN_IN = "event:/sfx/sfx_ui/ui_sys/ui_yuantu_in",
  BOSS_TRANSFORM = "event:/sfx/sfx_ui/ui_sys/ui_btl_lingzhukuanghua",
  MONTH_TIPS = "event:/sfx/sfx_ui/ui_sys/ui_contract_reward",
  GUILD_LEVEL_UP = "event:/sfx/sfx_ui/ui_sys/ui_lvup_team",
  ROGUE_TALENT_SELET = "event:/sfx/sfx_ui/ui_sys/ui_yuantu_tactics_select",
  ROGUE_TALENT_UP = "event:/sfx/sfx_ui/ui_sys/ui_yuantu_tactics_lvup",
  ROGUE_DIFFICULTY_SELET = "event:/sfx/sfx_ui/ui_sys/ui_yuantu_diff_lv",
  ACTIVITY_MAIN_IN = "event:/sfx/sfx_ui/ui_sys/ui_shouyi_winin",
  ACTIVITY_THREE_MAIN_IN = "event:/sfx/sfx_ui/ui_sys/ui_xinling_in",
  ACTIVITY_THREE_GAME_END = "event:/sfx/sfx_ui/ui_sys/lingxi_game_jiesuan",
  ACTIVITY_THREE_GAME_TURN = "event:/sfx/sfx_ui/ui_sys/lingxi_game_turn",
  ACTIVITY_THREE_GAME_COM = "event:/sfx/sfx_ui/ui_sys/lingxi_game_con",
  GUILD_WAR_SKILL_BUTTON = "event:/sfx/sfx_ui/ui_sys/ui_yuantu_right_tab_in",
  ACTIVITY_MINING_PICK_GU = "event:/sfx/sfx_ui/ui_sys/sfx_wuqugame_pick_pet",
  ACTIVITY_MINING_PICK = "event:/sfx/sfx_ui/ui_sys/sfx_wuqugame_pick_item",
  ACTIVITY_MINING_PICK_GET = "event:/sfx/sfx_ui/ui_sys/sfx_wuqugame_reward_fx",
  ACTIVITY_MINING_ACTION = "event:/sfx/sfx_ui/ui_sys/sfx_wuqugame_pick_action",
  ACTIVITY_MINING_NOTIF = "event:/sfx/sfx_ui/ui_sys/sfx_wuqugame_chest_notif",
  ACTIVITY_MINING_CMN = "event:/sfx/sfx_ui/ui_sys/sfx_wuqugame_notif_cmn",
  ACTIVITY_MINING_END = "event:/sfx/sfx_ui/ui_sys/lingxi_game_jiesuan"
}
local SoundUtil = {
  curMusicSoundId = nil,
  curMusicEventInstance = nil,
  lastMusicSoundId = nil
}

function SoundUtil.SetSfxSpeedInBattle(speed)
  SoundManager:SetSfxSpeed(speed)
end

function SoundUtil.PlaySfxInBattle(eventPath, bank, gameObject)
  return SoundManager:PlaySfxSound(eventPath, bank, gameObject, true)
end

function SoundUtil.PlayUISfx(soundPath, bankName, gameObject)
  if soundPath then
    return SoundManager:PlaySfxSound(soundPath, bankName or "bank:/sfx/sfx_ui/ui_sys/ui_sys", gameObject)
  end
end

function SoundUtil.PlaySfx(soundPathId)
  local config = TableData.GetConfig(soundPathId, "BaseSoundPath")
  if config then
    return SoundManager:PlaySfxSound(config.path, config.bank)
  end
end

function SoundUtil.PlaySfxByPath(path, bank)
  SoundManager:PlaySfxSound(path, bank)
end

function SoundUtil.PlayMusic(soundPathId, dontSaveAsLastSound, homeMusic)
  if SoundUtil.curMusicSoundId == soundPathId then
    if not homeMusic then
      if SoundUtil.bgmSwitchTimer then
        SoundUtil.bgmSwitchTimer:stop()
        SoundUtil.bgmSwitchTimer = nil
      end
    elseif not SoundUtil.bgmSwitchTimer then
      local config = TableData.GetConfig(soundPathId, "BaseSoundPath")
      local duration = SoundManager:GetDuration(config.path, config.bank)
      local _, position = SoundUtil.curMusicEventInstance:getTimelinePosition()
      duration = (duration - position) / 1000
      SoundUtil.bgmSwitchTimer = TimerUtil.setTimeout(duration, function()
        SoundUtil.bgmSwitchTimer = nil
        MusicPlaybackMgr.PlayNextMusic()
      end)
    end
    return
  end
  SoundUtil.StopCurMusic(false, dontSaveAsLastSound)
  local config = TableData.GetConfig(soundPathId, "BaseSoundPath")
  if config then
    if not homeMusic then
      local bgmSwitchTimer = SoundUtil.bgmSwitchTimer
      if bgmSwitchTimer then
        bgmSwitchTimer:stop()
      end
      SoundUtil.bgmSwitchTimer = nil
    end
    SoundUtil.curMusicEventInstance = SoundManager:PlayMusicSound(config.path, config.bank)
    SoundUtil.curMusicSoundId = soundPathId
    if homeMusic and not SoundUtil.bgmSwitchTimer then
      local duration = SoundManager:GetDuration(config.path, config.bank)
      local _, position = SoundUtil.curMusicEventInstance:getTimelinePosition()
      duration = (duration - position) / 1000
      SoundUtil.bgmSwitchTimer = TimerUtil.setTimeout(duration, function()
        SoundUtil.bgmSwitchTimer = nil
        MusicPlaybackMgr.PlayNextMusic()
      end)
    end
  end
end

function SoundUtil.StopCurMusic(immediate, dontSaveAsLastSound)
  if SoundUtil.curMusicEventInstance then
    local bgmSwitchTimer = SoundUtil.bgmSwitchTimer
    if bgmSwitchTimer then
      bgmSwitchTimer:stop()
    end
    SoundUtil.bgmSwitchTimer = nil
    SoundManager:StopSoundEvent(SoundUtil.curMusicEventInstance, immediate or false)
    if true ~= dontSaveAsLastSound then
      SoundUtil.lastMusicSoundId = SoundUtil.curMusicSoundId
    end
    SoundUtil.curMusicSoundId = nil
    SoundUtil.curMusicEventInstance = nil
  end
end

function SoundUtil.PlayLastMusic()
  if SoundUtil.lastMusicSoundId then
    local config = TableData.GetConfig(SoundUtil.lastMusicSoundId, "BaseSoundPath")
    if config then
      local trigger_sound = config.trigger_sound
      if trigger_sound then
        SoundUtil.PlaySfx(trigger_sound)
        LeanTween.delayedCall(0.2, function()
          SoundUtil.PlayMusic(SoundUtil.lastMusicSoundId)
        end)
        return
      end
    end
    SoundUtil.PlayMusic(SoundUtil.lastMusicSoundId)
  end
end

function SoundUtil.PlayVoice(eventPath, bank, gameObject)
  return SoundManager:PlayVoiceSound(eventPath, bank, gameObject)
end

function SoundUtil.GetCurMusic()
  return SoundUtil.curMusicEventInstance
end

function SoundUtil.StopSoundEvent(curSoundEventIns)
  if curSoundEventIns and curSoundEventIns:isValid() then
    SoundManager:StopSoundEvent(curSoundEventIns)
  end
end

function SoundUtil.PlayHomeMusic(dontPlayTriggerSound)
  local soundId = 1001
  local playlist = MusicPlaybackData.GetPlaylist()
  if playlist and #playlist > 0 then
    local playIndex = MusicPlaybackData.GetPlayIndex()
    if not playIndex or playIndex <= 0 or playIndex > #playlist then
      playIndex = 1
      MusicPlaybackData.SetPlayIndex(playIndex)
    end
    local id = playlist[MusicPlaybackData.GetPlayIndex()]
    local tbl = TableData.GetTable("BaseSoundPath")
    local config = TableData.GetConfig(id, "BaseSound")
    for _, v in pairs(tbl) do
      if v.path == config.path then
        soundId = v.id
        break
      end
    end
  end
  local config = TableData.GetConfig(soundId, "BaseSoundPath")
  if config and true ~= dontPlayTriggerSound then
    local trigger_sound = config.trigger_sound
    if trigger_sound then
      SoundUtil.PlaySfx(trigger_sound)
      LeanTween.delayedCall(0.2, function()
        SoundUtil.PlayMusic(soundId, false, true)
      end)
      return
    end
  end
  SoundUtil.PlayMusic(soundId, false, true)
end

return SoundUtil
